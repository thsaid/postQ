---
title: "MANOVA"
author: "Tamer Said"
date: "24/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Following Andy Field's codes 

```{r}
install.packages("car"); install.packages("ggplot2"); install.
packages("mvoutlier"); install.packages("mvnormtest"); install.
packages("pastecs"); install.packages("reshape"); install.
packages("WRS", repos="http://R-Forge.R-project.org")
library(car); library(ggplot2); library(MASS); library(mvoutlier);
library(mvnormtest); library(pastecs); library(reshape); library(WRS)
library(tidyverse)
library(ggpubr)
library(rstatix)
library(car)
library(broom)
```

#Data reshape: I resphaed the data in excel to mimik Fields' strcuture: New coloumn is inserted for group and will proceed in the MANOVA.rmd file

```{r}
PrePostCC <- read.csv("PrePostCC_wide-mod.csv")
```

Changing the group variable to factor with 2 levels

```{r}
PrePostCC$Group<-factor(PrePostCC$Group, levels = c("Pre", "Post"))
```

```{r}
library(pastecs)
```

Doing a comparative analysis for Q08 between pre and post
```{r}
by(PrePostCC$Q08, PrePostCC$Group, stat.desc, basic = FALSE)
```

```{r}
describeBy(PrePostCC, group = "Group")
```

Checking Homogeneity of covariance matrices (code did not work)

```{r}
cov("Q08":"Q24", use = "complete.obs")
```


```{r}
by(PrePostCC[, 3:18], PrePostCC$Group, cov)
```

#Data visualization

```{r}
ggboxplot(
  PrePost_mean, x = "Question", y = c("PreValue", "Post.Value"), 
  merge = TRUE, palette = "jco"
  )
```

Plotting for outliers (based on the box plot above, Q08 & Q22, showed to be outlires, I can specifically look for outliers )


```{r}
PrePostCC %>%
  group_by(Group) %>%
  identify_outliers(Q08) # 120 rows were identified
```

```{r}
PrePostCC %>%
  group_by(Group) %>%
  identify_outliers(Q22)
```
77 inputs showed to be outliers


#Mutlivariate ouliers: 
The Mahalanobis distance is generally used to detect multivariate outliers. The distance tells us how far an observation is from the center of the cloud, taking into account the shape (covariance) of the cloud as well.


```{r}
# Compute distance by groups and filter outliers
# Use -id to omit the id column in the computation
PrePostCC %>%
 group_by(Group) %>%
 mahalanobis_distance %>%
 filter(is.outlier == TRUE) %>%
  as.data.frame()

```

Nothing was identified using this test..

#Check univariate normality assumption

The normality assumption can be checked by computing Shapiro-Wilk test for each outcome variable at each level of the grouping variable. If the data is normally distributed, the p-value should be greater than 0.05.

```{r}
PrePostCC %>%
  group_by(Group) %>%
  shapiro_test(Q08, Q09, Q10, Q11, Q12, Q13, Q14, Q15, Q16, Q17, Q18, Q19, Q20, Q21, Q22, Q24) %>%
  arrange(variable)
```

All the data shows that they are NOT normally distributed. This is expected since the data is binomial. 


```{r}
aq.plot(PrePostCC[, 3:18])
```

#MANOVA model

newModel<-manova(outcome ~ predictor(s), data = dataFrame, na.action = na.exclude()

```{r}
PrePostCC %>%
Question <- cbind("Q08":"Q24")
```


```{r}
newModel<-manova(cbind(Q08:Q24)~ Group, data = PrePostCC, na.action = na.exclude)
```

```{r}
PrePost_mean <- read.csv("PrePostCC_mean.csv")
```


```{r}
meanModel <- manova (Question ~ cbind(PreValue, Post.Value), data = PrePost_mean,na.action = na.exclude)
```

